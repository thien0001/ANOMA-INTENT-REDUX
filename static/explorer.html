<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Anoma Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadeIn 0.6s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .toast { animation: slideUp 0.4s ease-out; }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white min-h-screen flex flex-col">

  <!-- Navbar -->
  <header class="bg-gray-900/60 backdrop-blur-md fixed top-0 left-0 right-0 shadow-lg z-50">
    <div class="max-w-6xl mx-auto flex justify-between items-center px-6 py-4">
      <div class="flex items-center space-x-3">
        <img src="logo.jpg" alt="Anoma Logo" class="h-10">
        <span class="font-bold text-xl">Anoma Explorer</span>
      </div>
      <nav class="space-x-6 hidden md:block">
        <a href="/" class="hover:text-indigo-400">Home</a>
        <a href="/#guide" class="hover:text-indigo-400">Guide</a>
        <a href="/#history" class="hover:text-indigo-400">History</a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 flex flex-col items-center justify-center pt-28 pb-16 px-4">
    <div class="max-w-2xl w-full bg-gray-800/70 backdrop-blur-xl rounded-2xl shadow-2xl p-8 fade-in">
      <h1 class="text-3xl font-bold text-center mb-6">üîç Transaction Explorer</h1>

      <!-- Loading -->
      <div id="loading" class="animate-pulse space-y-4">
        <div class="h-6 bg-gray-600 rounded w-2/3"></div>
        <div class="h-6 bg-gray-600 rounded w-1/2"></div>
        <div class="h-6 bg-gray-600 rounded w-1/3"></div>
      </div>

      <!-- Tx Detail -->
      <div id="txDetails" class="hidden space-y-4 text-lg">
        <p><strong>Tx Hash:</strong> <span id="txHash" class="text-indigo-400"></span></p>
        <p class="flex items-center gap-2"><strong>Chain:</strong> <img id="chainLogo" class="h-5 w-5"> <span id="chain"></span></p>
        <p><strong>Action:</strong> <span id="action"></span></p>
        <p><strong>Token:</strong> <span id="token"></span></p>
        <p><strong>Amount:</strong> <span id="amount" class="text-green-400 text-xl font-bold"></span></p>
        <p><strong>Gas Fee:</strong> <span id="gasFee" class="text-red-400 text-xl font-bold"></span></p>
      </div>

      <!-- Back -->
      <div class="mt-8 text-center">
        <a href="/" class="bg-indigo-600 hover:bg-indigo-700 px-6 py-3 rounded-xl font-bold transition">‚¨Ö Back</a>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 py-4 text-center text-gray-500">
    ¬© 2025 Anoma Intent Demo ‚Äì Built with üíú
  </footer>

  <!-- Toast -->
  <div id="toastContainer" class="fixed bottom-4 right-4 space-y-2 z-50"></div>

  <script>
    const chainLogos = {
      Ethereum: "https://cryptologos.cc/logos/ethereum-eth-logo.svg?v=029",
      Polygon: "https://cryptologos.cc/logos/polygon-matic-logo.svg?v=029",
      BSC: "https://cryptologos.cc/logos/bnb-bnb-logo.svg?v=029",
      Arbitrum: "https://cryptologos.cc/logos/arbitrum-arb-logo.svg?v=029",
      Optimism: "https://cryptologos.cc/logos/optimism-ethereum-op-logo.svg?v=029"
    };

    function showToast(msg, type="info") {
      const container = document.getElementById("toastContainer");
      const toast = document.createElement("div");
      toast.className = `toast px-4 py-3 rounded-lg shadow-lg text-white ${
        type==="success" ? "bg-green-600" : type==="error" ? "bg-red-600" : "bg-gray-700"
      }`;
      toast.innerText = msg;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    async function fetchTx() {
      const params = new URLSearchParams(window.location.search);
      const txHash = params.get("tx");
      if (!txHash) {
        showToast("‚ùå No Tx Hash provided", "error");
        return;
      }

      try {
        const res = await fetch("/history");
        const history = await res.json();
        const tx = history.find(h => h.TxHash === txHash);

        document.getElementById("loading").classList.add("hidden");
        const box = document.getElementById("txDetails");
        box.classList.remove("hidden");

        if (tx) {
          document.getElementById("txHash").innerText = tx.TxHash;
          document.getElementById("chain").innerText = tx.Chain;
          document.getElementById("chainLogo").src = chainLogos[tx.Chain] || "";
          document.getElementById("action").innerText = tx.Action;
          document.getElementById("token").innerText = tx.Token;
          document.getElementById("amount").innerText = tx.Amount + " " + tx.Token;
          document.getElementById("gasFee").innerText = tx.GasFee;
          showToast("‚úÖ Transaction loaded", "success");
        } else {
          document.getElementById("txDetails").innerHTML = "<p class='text-red-400 text-center'>‚ùå Transaction not found.</p>";
          showToast("‚ùå Transaction not found", "error");
        }
      } catch (e) {
        showToast("‚ö†Ô∏è Error fetching transaction", "error");
      }
    }

    fetchTx();
  </script>
</body>
</html>
